# 协议 
## 网络模型分层
计算机互联这件事情本身牵扯到软硬件、以及各种复杂的情况。所以通过模型的方式，将网络互联这个过程抽像成几个独立的步骤：即分层模型。协议就是每一层的语言。协议与具体的语言无关。

![[Pasted image 20220521131031.png]]



![[Pasted image 20220521145029.png]]

应用层如HTTP层，将报文组装好：HTTP头+HTTP报文。调用四层接口即TCP层。tcp层继续封装报文，增加tcp协议信息：TCP头，TCP头包含本地端口和目标端口。然后调用三层接口即IP层。IP继续封装报文，增加iP协议信息：IP报文头。ip头部包含本地ip和目标ip。然后调用二层接口即mac层，在二层中继续封装报文：增加本地mac信息和目标mac信息。如果目标服务器在本地网络，那么目标mac可以直接获得并填充到报文中；如果目标服务器是外部网络ip，那么目标mac填写的是本地网关的mac。

这里面有几个细节信息：
1. 如何获得目标的ip，如何获得目标服务器的mac。
2. 每一层对上层报文数据的封装，不仅仅是在协议层面上增加本层信息，同时也有着数据切分，传输控制等工作内容。
3. 每一个数据报文究竟是如何层层路由最终走到了目标服务器的。



__这里要记住一点：只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。

`所以，对 TCP 协议来说，三次握手也好，重试也好，只要想发出去包，就要有 IP 层和 MAC 层(上层协议数据一定要有下层)，不然是发不出去的。经常有人会问这样一个问题，我都知道那台机器的 IP 地址了，直接发给他消息呗，要 MAC 地址干啥？这里的关键就是，没有 MAC 地址消息是发不出去的。所以如果一个 HTTP 协议的包跑在网络上，它一定是完整的。无论这个包经过哪些设备，它都是完整的。所谓的二层设备、三层设备，就是这些设备上跑的程序工作在不同的层而已。一个 HTTP 协议的包经过一个二层设备，二层设备收进去的是整个网络包。这里面 HTTP、TCP、 IP、 MAC 都有。什么叫二层设备呀，就是只把 MAC 头摘下来，看看到底是丢弃、转发，还是自己留着。那什么叫三层设备呢？就是把 MAC 头摘下来之后，再把 IP 头摘下来，看看到底是丢弃、转发，还是自己留着。

